
#---- setup ----

if $(OS) = NT {
	C++FLAGS = /nologo /c /EHsc /W3 /WX /MD /I"kit-libs-win/out/include" /I"kit-libs-win/out/include/SDL2" /I"kit-libs-win/out/libpng"
		#disable a few warnings:
		/wd4146 #-1U is still unsigned
		/wd4297 #unforunately SDLmain is nothrow
	;
	LINKFLAGS = /nologo /SUBSYSTEM:CONSOLE
		/LIBPATH:"kit-libs-win/out/lib"
		/LIBPATH:"kit-libs-win/out/libpng"
		/LIBPATH:"kit-libs-win/out/zlib"
	;
	LINKLIBS = SDL2main.lib SDL2.lib OpenGL32.lib libpng.lib zlib.lib ;

	File dist\\SDL2.dll : kit-libs-win\\out\\dist\\SDL2.dll ;
} else if $(OS) = MACOSX {
	C++ = clang++ ;
	C++FLAGS =
		-std=c++14 -g -Wall -Werror
		-Ikit-libs-osx/out -Ikit-libs-osx/out/SDL2      #local libs
		-I/usr/local/include -I/usr/local/include/SDL2  #system libs
		-D_THREAD_SAFE #for some reason, SDL wants this
		;
	LINK = clang++ ;
	LINKFLAGS = -std=c++14 -g -Wall -Werror
		-Lkit-libs-osx/out/lib   #local libs
		-L/usr/local/lib         #system libs
		-lSDL2 -lpng -framework OpenGL
		#misc SDL dependencies:
		-liconv -lobjc
 		-framework CoreAudio
		-framework AudioToolbox
		-framework CoreVideo
		-framework Cocoa
		-framework Carbon
		-framework IOKit
		;
} else if $(OS) = LINUX {
	C++ = g++ ;
	C++FLAGS =
		-std=c++11 -g -Wall -Werror
		-Ikit-libs-osx/out -Ikit-libs-osx/out/SDL2      # local libs
		-I/usr/include/SDL2                             # system libs
 		-D_REENTRANT #for some reason, SDL wants this
		;
	LINK = g++ ;
	LINKFLAGS = -std=c++11 -g -Wall -Werror
		-Lkit-libs-linux/out/lib -Wl,-rpath,kit-libs-linux/out/lib #local libs
	;
	LINKLIBS = -lSDL2 -lm -ldl -lpthread -lGL -lpng -lz ;
}

#---- build ----

NAMES =
	main
	load_save_png
	;

if $(OS) = NT {
	NAMES += gl_shims ;
}

LOCATE_TARGET = objs ; #put objects in 'objs' directory
Objects $(NAMES:S=.cpp) ;

LOCATE_TARGET = dist ; #put main in 'dist' directory
MainFromObjects main : $(NAMES:S=$(SUFOBJ)) ;
